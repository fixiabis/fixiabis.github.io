<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0px;
        }

        #a,
        #b {
            width: calc(50% - 10px);
            height: calc(100% - 10px);
            box-sizing: border-box;
            padding: 5px;
            border: 0px;
        }
    </style>
    <script src="enfuck.js"></script>
    <script src="$_.js"></script>
</head>

<body>
    <textarea id="a"></textarea>
    <textarea id="b"></textarea>
    <script>
        var text = document.querySelector("#a"),
            textarea = document.querySelector("#b");
        window.onkeydown = function (event) {
            if (event.which == 9) {
                event.preventDefault();
                var content = text.value,
                    start = text.selectionStart,
                    end = text.selectionEnd;
                if (start != end) return;
                var fContent = content.substr(0, start),
                    bContent = content.substr(start, content.length);
                text.value = fContent + "    " + bContent;
                text.selectionStart = start + 4;
                text.selectionEnd = start + 4;
            }
        };
        function enFuck(content, tabs) {
            var enContent = "";
            for (var i = 0; i < content.length; i++) {
                if (!fromCharCode[content[i]])
                    fromCharCode[content[i]] = "__$(" + getNum(content[i].charCodeAt()) + ")";
                if (code[content[i]] && code[content[i]].length < fromCharCode[content[i]].length)
                    enContent += code[content[i]];
                else
                    enContent += fromCharCode[content[i]];
                if (i < content.length - 1) enContent += "+\n" + tabs;
            }
            return enContent;
        }
        text.oninput = function () {
            if (this.value[0] == "\"") return;
            var enString = "",
                content = this.value.replace(/\"\"/g, "[]+[]").match(/[^\"]+/g);
            for (var i = 0; i < content.length; i++) {
                if (i % 2 == 0) enString += content[i];
                else {
                    var tabs = "";
                    if (content[i - 1].length > 0) {
                        var lines = content[i - 1].split("\n"),
                            lastLine = lines[lines.length - 1],
                            spaceMatch = lastLine.match(/ /g);
                        if (spaceMatch.length == lastLine.length)
                            tabs = lastLine;
                    }
                    enString += enFuck(content[i], tabs);
                };
            }
            var nums = enString.match(/[0-9]+\.[0-9]+|[0-9]+/g);
            if (nums)
                for (var i = 0; i < nums.length; i++)
                    enString = enString.replace(nums[i], getNum(nums[i]));
            textarea.value = enString;
        }
        function getNum(v) {
            v = v + "";
            var result = "";
            for (var i = 0; i < v.length; i++) {
                var val = "";
                if (v[i] == 0)
                    val = "+[]";
                else if (v[i] == ".")
                    val = "__$((+!![]+!![]+!![]+!![]+[]+(+!![]+!![]+!![]+!![]+!![]+!![])))";
                else
                    for (var j = 0; j < v[i]; j++)
                        val += "+!![]";
                if (i != 0)
                    result += `+(${val})`;
                else
                    result += val + (v.length != 1 ? "+[]" : "");
            }
            return v.length != 1 ? `(+(${result}))` : result;
        }
    </script>
</body>

</html>